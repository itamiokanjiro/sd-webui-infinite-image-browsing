import{c as a,A as De,d as Fe,r as b,o as Ue,cb as ee,m as Be,C as Ee,az as He,z as Pe,B as Ge,E as te,cc as Ke,a1 as Le,U as f,V as F,a3 as t,a4 as e,W as u,X as o,Y as i,a2 as h,$ as y,a5 as U,cn as je,ag as R,a6 as ae,L as Ne,af as qe,Z as Je,T as le,aj as We,co as Qe,ah as Xe,ak as se,cg as Ye,ai as Ze,aP as et,aQ as tt,cp as at,ci as lt,a0 as st}from"./index-9ea28d47.js";import{S as nt}from"./index-559ee174.js";/* empty css              */import"./index-f9446c9d.js";import{c as it,d as ot,F as rt}from"./FileItem-a5d8808c.js";import{M as dt,o as ut,L as ct,R as pt,f as ft}from"./MultiSelectKeep-dbeb969c.js";import{c as vt,u as mt}from"./hook-25fc17ae.js";import{f as O,H as ne,_ as gt,a as _t}from"./searchHistory-091a2fc2.js";import"./numInput.vue_vue_type_style_index_0_scoped_55978858_lang-1089a22e.js";/* empty css              */import"./_isIterateeCall-c5995cdf.js";import"./index-336f750c.js";import"./shortcut-70212e50.js";import"./Checkbox-716ad574.js";import"./index-2f7349b8.js";import"./useGenInfoDiff-2b0f1c22.js";var ht={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"};const yt=ht;function ie(c){for(var p=1;p<arguments.length;p++){var d=arguments[p]!=null?Object(arguments[p]):{},v=Object.keys(d);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(d).filter(function(k){return Object.getOwnPropertyDescriptor(d,k).enumerable}))),v.forEach(function(k){kt(c,k,d[k])})}return c}function kt(c,p,d){return p in c?Object.defineProperty(c,p,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[p]=d,c}var B=function(p,d){var v=ie({},p,d.attrs);return a(De,ie({},v,{icon:yt}),null)};B.displayName="AimOutlined";B.inheritAttrs=!1;const bt=B,wt="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",E=c=>(et("data-v-af0b8c79"),c=c(),tt(),c),St={style:{"padding-right":"16px"}},Ct=E(()=>u("div",null,null,-1)),xt=["title"],It=["src"],$t={class:"search-bar"},At={class:"form-name"},Rt={class:"search-bar last actions"},Ot={class:"hint"},zt={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},Mt={style:{margin:"16px 32px 16px"}},Tt={style:{"padding-right":"16px"}},Vt=E(()=>u("div",null,null,-1)),Dt=E(()=>u("div",{style:{padding:"16px 0 512px"}},null,-1)),Ft={key:2,class:"preview-switch"},Ut=Fe({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(c){const p=c,d=b(!1),v=b(""),k=b(!1),S=b(p.searchScope??""),C=b(!1),H=b(0),x=b("all"),z=vt(l=>{const s={cursor:l,regexp:d.value?v.value:"",surstr:d.value?"":v.value,path_only:k.value,folder_paths:(S.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r),media_type:x.value};return at(s)}),{queue:w,images:m,onContextMenuClickU:P,stackViewEl:oe,previewIdx:I,previewing:G,onPreviewVisibleChange:re,previewImgMove:K,canPreview:L,itemSize:j,gridItems:de,showGenInfo:$,imageGenInfo:N,q:ue,multiSelectedIdxs:M,onFileItemClick:ce,scroller:q,showMenuIdx:T,onFileDragStart:pe,onFileDragEnd:fe,cellWidth:ve,onScroll:J,saveAllFileAsJson:me,saveLoadedFileAsJson:ge,props:_e,changeIndchecked:he,seedChangeChecked:ye,getGenDiff:ke,getGenDiffWatchDep:be}=mt(z),g=b();Ue(async()=>{g.value=await ee(),g.value.img_count&&g.value.expired&&await W(),p.searchScope&&await A()}),Be(()=>p,async l=>{_e.value=l},{deep:!0,immediate:!0});const W=Ee(()=>w.pushAction(async()=>(await lt(),g.value=await ee(),g.value)).res),Q=l=>{v.value=l.substr,S.value=l.folder_paths_str,d.value=l.isRegex,x.value=l.mediaType||"all",C.value=!1,A()},A=async()=>{H.value++,O.value.add({substr:v.value,folder_paths_str:S.value,isRegex:d.value,mediaType:x.value}),await z.reset({refetch:!0}),await He(),J(),q.value.scrollToItem(0),m.value.length||Pe.info(Ge("fuzzy-search-noResults"))};te("returnToIIB",async()=>{const l=await w.pushAction(Ke).res;g.value.expired=l.expired}),te("searchIndexExpired",()=>g.value&&(g.value.expired=!0));const we=()=>{d.value=!d.value},Se=Le(),{onClearAllSelected:Ce,onSelectAll:xe,onReverseSelect:Ie}=it();return(l,s)=>{const r=gt,_=_t,$e=le,Ae=We,V=Qe,Re=Xe,X=se,Oe=Ye,D=se,ze=Ze,Me=le,Te=nt;return f(),F(Je,null,[a($e,{visible:C.value,"onUpdate:visible":s[0]||(s[0]=n=>C.value=n),width:"70vw","mask-closable":"",onOk:s[1]||(s[1]=n=>C.value=!1)},{default:t(()=>[a(ne,{records:e(O),onReuseRecord:Q},{default:t(({record:n})=>[u("div",St,[a(_,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(f(),h(_,{key:0},{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("searchScope"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):y("",!0),a(_,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.isRegex),1)]),_:2},1024)]),_:2},1024),n.mediaType?(f(),h(_,{key:1},{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("mediaType"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.mediaType),1)]),_:2},1024)]),_:2},1024)):y("",!0),a(_,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("time"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.time),1)]),_:2},1024)]),_:2},1024),Ct])]),_:1},8,["records"])]),_:1},8,["visible"]),u("div",{class:"container",ref_key:"stackViewEl",ref:oe},[a(dt,{show:!!e(M).length||e(Se).keepMultiSelect,onClearAllSelected:e(Ce),onSelectAll:e(xe),onReverseSelect:e(Ie)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),u("div",{class:"search-bar",onKeydown:s[7]||(s[7]=U(()=>{},["stop"]))},[a(Ae,{value:v.value,"onUpdate:value":s[2]||(s[2]=n=>v.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(w).isIdle,onKeydown:je(A,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),a(Re,{value:x.value,"onUpdate:value":s[3]||(s[3]=n=>x.value=n),style:{width:"100px",margin:"0 4px"},disabled:!e(w).isIdle},{default:t(()=>[a(V,{value:"all"},{default:t(()=>[o(i(l.$t("all")),1)]),_:1}),a(V,{value:"image"},{default:t(()=>[o(i(l.$t("image")),1)]),_:1}),a(V,{value:"video"},{default:t(()=>[o(i(l.$t("video")),1)]),_:1})]),_:1},8,["value","disabled"]),u("div",{class:R(["regex-icon",{selected:k.value}]),onKeydown:s[4]||(s[4]=U(()=>{},["stop"])),onClick:s[5]||(s[5]=n=>k.value=!k.value),title:l.$t("pathOnly")},[a(e(bt))],42,xt),u("div",{class:R(["regex-icon",{selected:d.value}]),onKeydown:s[6]||(s[6]=U(()=>{},["stop"])),onClick:we,title:"Use Regular Expression"},[u("img",{src:e(wt)},null,8,It)],34),g.value&&(g.value.expired||!g.value.img_count)?(f(),h(X,{key:0,onClick:e(W),loading:!e(w).isIdle,type:"primary"},{default:t(()=>[o(i(g.value.img_count===0?l.$t("generateIndexHint"):l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):(f(),h(X,{key:1,type:"primary",onClick:A,loading:!e(w).isIdle||e(z).loading},{default:t(()=>[o(i(l.$t("search")),1)]),_:1},8,["loading"]))],32),u("div",$t,[u("div",At,i(l.$t("searchScope")),1),a(Oe,{"auto-size":{maxRows:8},value:S.value,"onUpdate:value":s[8]||(s[8]=n=>S.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),u("div",Rt,[e(m).length?(f(),h(D,{key:0,onClick:e(ge)},{default:t(()=>[o(i(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):y("",!0),e(m).length?(f(),h(D,{key:1,onClick:e(me)},{default:t(()=>[o(i(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):y("",!0),a(D,{onClick:s[9]||(s[9]=n=>C.value=!0)},{default:t(()=>[o(i(l.$t("history")),1)]),_:1})]),a(Te,{size:"large",spinning:!e(w).isIdle},{default:t(()=>[a(Me,{visible:e($),"onUpdate:visible":s[11]||(s[11]=n=>ae($)?$.value=n:null),width:"70vw","mask-closable":"",onOk:s[12]||(s[12]=n=>$.value=!1)},{cancelText:t(()=>[]),default:t(()=>[a(ze,{active:"",loading:!e(ue).isIdle},{default:t(()=>[u("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[10]||(s[10]=n=>e(Ne)(e(N)))},[u("div",Ot,i(l.$t("doubleClickToCopy")),1),o(" "+i(e(N)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),H.value===0&&!e(m).length&&e(O).getRecords().length?(f(),F("div",zt,[u("h2",Mt,i(l.$t("restoreFromHistory")),1),a(ne,{records:e(O),onReuseRecord:Q},{default:t(({record:n})=>[u("div",Tt,[a(_,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(f(),h(_,{key:0},{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("searchScope"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):y("",!0),a(_,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.isRegex),1)]),_:2},1024)]),_:2},1024),n.mediaType?(f(),h(_,{key:1},{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("mediaType"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.mediaType),1)]),_:2},1024)]),_:2},1024)):y("",!0),a(_,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[o(i(l.$t("time"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[o(i(n.time),1)]),_:2},1024)]),_:2},1024),Vt])]),_:1},8,["records"])])):y("",!0),e(m)?(f(),h(e(ot),{key:1,ref_key:"scroller",ref:q,class:"file-list",items:e(m),"item-size":e(j).first,"key-field":"fullpath","item-secondary-size":e(j).second,gridItems:e(de),onScroll:e(J)},{after:t(()=>[Dt]),default:t(({item:n,index:Y})=>[a(rt,{idx:Y,file:n,"show-menu-idx":e(T),"onUpdate:showMenuIdx":s[13]||(s[13]=Z=>ae(T)?T.value=Z:null),onFileItemClick:e(ce),"full-screen-preview-image-url":e(m)[e(I)]?e(qe)(e(m)[e(I)]):"","cell-width":e(ve),selected:e(M).includes(Y),onContextMenuClick:e(P),onDragstart:e(pe),onDragend:e(fe),onTiktokView:(Z,Ve)=>e(ut)(e(m),Ve),"enable-change-indicator":e(he),"seed-change-checked":e(ye),"get-gen-diff":e(ke),"get-gen-diff-watch-dep":e(be),"is-selected-mutil-files":e(M).length>1,onPreviewVisibleChange:e(re)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","onTiktokView","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):y("",!0),e(G)?(f(),F("div",Ft,[a(e(ct),{onClick:s[14]||(s[14]=n=>e(K)("prev")),class:R({disable:!e(L)("prev")})},null,8,["class"]),a(e(pt),{onClick:s[15]||(s[15]=n=>e(K)("next")),class:R({disable:!e(L)("next")})},null,8,["class"])])):y("",!0)]),_:1},8,["spinning"]),e(G)&&e(m)&&e(m)[e(I)]?(f(),h(ft,{key:0,file:e(m)[e(I)],idx:e(I),onContextMenuClick:e(P)},null,8,["file","idx","onContextMenuClick"])):y("",!0)],512)],64)}}});const ea=st(Ut,[["__scopeId","data-v-af0b8c79"]]);export{ea as default};
